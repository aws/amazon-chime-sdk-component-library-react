<Meta title="Migration to V3" />

# Migration from 2.0 to 3.0

Version 3 of the Amazon Chime React Component Library makes small changes to the interface of the library to make it more customizable.

### IMPORTANT - Version 3 of the library also requires a dependency to version 3.0.0 or higher of the amazon-chime-sdk-js.

In many cases you will need to adjust your application code because interface parameters to root providers like Meeting Provider are updated.

## Installation

Installation involves adjusting your package.json to depend on version 3.x.x

```
npm uninstall amazon-chime-sdk-component-library-react amazon-chime-sdk-js
npm install --save amazon-chime-sdk-component-library-react@beta amazon-chime-sdk-js@beta
```

## What's New

- `MeetingManager`'s `join()` method no longer takes an `EventReporter` and instead takes an `EventController`.
- Deprecate `useBandwidthMetrics` hook in favor of `useMediaStreamMetrics`.
- Remove legacy metrics `videoDownstreamGoogFrameHeight`, `videoDownstreamGoogFrameWidth`, `videoUpstreamGoogFrameHeight` and `videoUpstreamGoogFrameWidth` from the `videoStreamMetrics` returned by the `useMediaStreamMetrics` hook to adopt to Amazon Chime SDK for JavaScript V3 changes ([aws/amazon-chime-sdk-js#2086](https://github.com/aws/amazon-chime-sdk-js/pull/2086)).
- Update the `compilerOptions.target` in `tsconfig.json` from `es5` to `ES2015 (ES6)`.
- Rename the `global` property of `DefaultTheme` Interface to `globalStyle` to avoid conflict with reserved keyword `global`.

### Updating `EventReporter` to `EventController`

Before in 2.x:

```jsx
const MyApp = () => {
  const meetingManager = useMeetingManager();
  const joinMeeting = async () => {
    const response = await fetch('/my-meetings-endpoint');
    const data = await response.json();
    const joinData = {
      meetingInfo: data.Meeting,
      attendeeInfo: data.Attendee,
      eventReporter: new NoOpEventReporter()
    };
    try {
      await meetingManager.join(joinData);
    } catch {
      console.error('Something went wrong');
    }
  };

  return (
    <button onClick={joinMeeting}>Join Meeting</button>;
  );
};
```

After in 3.x:

```jsx
const MyApp = () => {
  const meetingManager = useMeetingManager();
  const joinMeeting = async () => {
    const response = await fetch('/my-meetings-endpoint');
    const data = await response.json();
    const meetingSessionConfiguration = new MeetingSessionConfiguration(data.Meeting, data.Attendee);
    const eventController = new DefaultEventController(
        meetingSessionConfiguration, 
        meetingManager.createLogger(meetingSessionConfiguration), 
        new NoOpEventReporter()
      );
    const joinData = {
      meetingSessionConfiguration: meetingSessionConfiguration,
      eventController: eventController
    };

    try {
      await meetingManager.join(joinData);
    } catch {
      console.error('Something went wrong');
    }
  };
  
  return (
    <button onClick={joinMeeting}>Join Meeting</button>;
  );
};
```

## WebRTC Metrics Change

### Deprecation of `useBandwidthMetrics` hook

The `useBandwidthMetrics` hook exposes two WebRTC metrics:

- `availableOutgoingBandwidth`
- `availableIncomingBandwidth`. 

The `useMediaStreamMetrics` covers all metrics of `useBandwidthMetrics` hook, so we decide to deprecate it in V3.

Before in 2.x:

To get the `availableOutgoingBandwidth` and `availableIncomingBandwidth` in V2.

```jsx
import React from 'react';
import {
  MeetingProvider,
  useBandwidthMetrics,
} from 'amazon-chime-sdk-component-library-react';

const App = () => (
  <MeetingProvider>
    <MyChild />
  </MeetingProvider>
);

const MyChild = () => {
  const metrics = useBandwidthMetrics();

  return (
    <>
      <p>Incoming Bandwidth: {metrics.availableIncomingBandwidth}</p>
      <p>Outgoing Bandwidth: {metrics.availableOutgoingBandwidth}</p>
    </>
  );
};
```

After in 3.x:

To get the `availableOutgoingBandwidth` and `availableIncomingBandwidth` in V3.

```jsx
import React from 'react';
import {
  MeetingProvider,
  useMediaStreamMetrics,
} from 'amazon-chime-sdk-component-library-react';

const App = () => (
  <MeetingProvider>
    <MyChild />
  </MeetingProvider>
);

const MyChild = () => {
  const metrics = useMediaStreamMetrics();

  return (
    <>
      <p>Incoming Bandwidth: {metrics.availableIncomingBandwidth}</p>
      <p>Bandwidth Outgoing: {metrics.availableOutgoingBandwidth}</p>
    </>
  );
};
```

## StyledComponent

### DefaultTheme Interface

In V3 we rename the `global` property of `DefaultTheme` Interface to `globalStyle` to avoid conflict with reserved keyword `global`.
When you implement your own theme, you need to use `globalStyle` instead of `global`.